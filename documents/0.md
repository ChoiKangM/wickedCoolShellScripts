# 0장 쉘 스크립트 특강

쉘 스트립트(`Shell Scripts`)는 특정 쉘(이 문서의 경우 `Bash`)이 일련의 명령을 스크립트에 적힌 순서대로 실행하도록 하는 텍스트 파일이고, 쉘(`Shell`)은 운영 체제가 제공하는 명령들을 사용할 수 있도록 해주는 커맨드라인 인터페이스(`Command Line Interface`)이다.  

![bash](../img/bash.png)  

터미널을 이용해 시스템과 상호작용하는 것은 벅찬 일 같아 보일 수도 있다.  
하지만 시간이 흐름에 따라 그냥 터미널을 열어 간단한 시스템 변경을 수행하는 것이 메뉴를 따라 마우스를 움직여 바꾸려는 옵션을 찾는것 보다 자연스러워질 것이다.

`Bash`의 아름다움은 이식성이고, 이 문서의 많은 스크립트가 `그대로 동작`할 것이다.

### 명령 실행하기
`Bash`의 핵심 능력은 시스템에서 명령을 실행하는 것이다.  
간단한 "Hello World!" 예제를 실험해보자.  
`echo` 명령은 다음과 같이 텍스트를 화면에 표시한다
```bash
$ echo "Hello World"
```
bash가 이들 표준 명령을 찾는 디렉터리는 `PATH`라는 환경 변수에 저장돼 있다.  
echo를 `PATH`변수에 함께 사용해 그 내용을 볼 수 있다.  
```bash
$ echo $PATH
```
출력된 디렉터리들은 서로 콜론으로 나뉘어 있다.  
bash는 사용자가 프로그램이나 명령을 실행하려고 할 때 이들 디렉터리를 찾아본다.  
해당 명령이 디렉터리에 저장돼 있지 않으면, bash는 실행할 수 없다.  
또한 bash는 PATH에 적힌 순서대로 살펴본다.  
이 순서가 중요한데, 같은 이름의 두 명령이 PATH에 있는 두 디렉터리에 있을 때 순서에 따라 차이가 발생하기 때문이다.  
특정 명령을 찾는 데 문제가 있다면, `which`명령을 이용해 쉘이 PATH 중 어디에 있는지 확인할 수 있다.  
```bash
$ which ruby
$ which echo
```
우리는 `which`를 이용해 명령의 전체 경로를 알아낼 것이다.  
`which`는 망가지거나 이상한 PATH를 디버그하는 유용한 도구이다.

### 로그인 스크립트 구성하기
이 문서 전체에 걸쳐 스크립트를 작성하고, 이를 다른 스크립트에서 사용할 것이므로 새로운 스크립트를 쉽게 부를 수 있어야 한다.  
새로운 명령 쉘을 시작할 때, 새로 작성한 스크립트가 다른 명령처럼 자동으로 호출 가능 상태가 되도록 PATH 변수를 설정할 수 있다.  
명령 쉘을 열면 쉘이 하는 첫 번째 작업은 홈 디렉토리(맥 OS는 `/Users/<사용자 이름>`, 리눅스는 `/home/<사용자 이름>`)에 있는 로그인 스크립트를 읽고, 그 안의 명령을 실행하는 것이다.  
아래의 코드가 들어간 파일이 로그인 스크립트이다
```bash
echo this is .로그인스크립트파일이름
```
작성자는 `~/.bash_profile` 파일을 로그인 스크립트로 지정했다.  

`cat`명령은 파일 이름을 인자로 받아 해당 파일의 내용을 콘솔 화면에 보여준다
```bash
$ cat ~/.bashrc
```
개발 디렉터리를 로그인 스크립트에 추가하기 위해 텍스트 에디터로 로그인 스크립트 파일을 열고 다음 행을 파일의 맨 위에 추가한다
```bash
export PATH="/path/to/scripts/:$PATH"
```
위의 코드가 추가되면, 여러분이 개발 폴더에 저장한 모든 스크립트를 쉘에서 명령으로 호출할 수 있다.

로그인 스크립트이니 `Bash`창을 껐다 키면 적용된다.

### 쉘 스크립트 진행하기
아래의 명령을 순서대로 실행하며,  
파일의 전체 시스템 경로와 그 내용을 빠르게 파악해보자
```bash
echo "Hello world"
echo $(which neqn)
cat $(which neqn)
```
1. echo 명령을 이용해 간단히 Hello World라는 텍스트를 출력
2. which를 이용해 neqn의 위치를 찾고 echo 명령을 이용해 화면에 출력  
  두 명령 중 한 명령이 다른 명령의 인자가 되도록 실행하기 위해 `서브 쉘`을 이용해 두번째 명령을 실행하고, 그 결과를 첫 번째 명령이 이용하도록 저장한다.  
  파일이 저장되면, 터미널에서 해당 쉘 스크립트를 실행할 수 있다.

### 쉘 스크립트를 보다 직관적으로 만들기
[`intro`](../shell_scripts/intro)
```bash
echo "Hello World"
echo $(which neqn)
cat $(which neqn)
```
`sh` 명령을 이용해 intro 스크립트를 인자로 쉘 스크립트를 실행한다
```bash
$ sh intro
```
잘 동작하는 것을 확인할 수 있다.  
스크립트를 실행하기 위해 `sh`명령을 사용할 필요는 없다.  
intro 쉘 스크립트에 한 줄 추가한 후,  
스크립트의 파일 시스템 권한을 수정하면, 해당 쉘 스크립트를 다른 bash 명령처럼 sh 명령없이 직접 호출할 수 있다.

[`intro`](../shell_scripts/intro)
```bash
#!/bin/bash
echo "Hello World"
echo $(which neqn)
cat $(which neqn)
```
파일 맨 위에 파일 시스템 경로 `/bin/bash`를 가리키는 한 줄을 추가했다.  
이를 셔뱅(`shebang`)이라 한다.  
셔뱅을 이용하면 어느 프로그램을 실행해 스크립트를 해석할지 정할 수 있다.  
여기서는 bash 파일로 설정했다.  
펄 언어(`#!/usr/bin/perl`)나 루비(`#!/usr/bin/env ruby`)를 위한 셔뱅을 본 적이 있을지도 모르겠다

쉘 스크립트를 프로그램처럼 실행하려면 아직 파일 권한 설정을 설정해야 한다.  
```bash
$ chmod +x intro
$ ./intro
$ intro
```
이제 bash를 부를 필요 없이 해당 쉘 스크립트를 직접 실행할 수 있다.  
이 문서에서 작성할 많은 스크립트는 intro 스크립트와 같이 실행 권한 설정이 필요하다.  


### 시작해보자
쉘 스크립트가 뭔지 몰랐다면, 이제 쉘 스크립트가 뭔지에 대한 개념이 잡혔을 것이다.  
작은 크기의 스크립트를 만들어 특정 작업을 수행하는 것이 유닉스 철학의 핵심이다.  
필요에 맞도록 스크립트를 만들고 유닉스 시스템을 확장하는 법을 이해하면 파워 유저가 될 수 있다.  
정말 사악한 쉘 스크립트의 세계로 온 것을 환영한다.